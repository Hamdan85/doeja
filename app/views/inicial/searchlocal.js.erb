<% if !@alert.nil? %>
    flash_notice('<%= escape_javascript(@alert) %>');
<% end %>

Gmaps.map.listen_to_markers = function(markers){
    if (markers.length == 1) {
        Gmaps.map.auto_zoom = false;
        setTimeout(function() { Gmaps.map.serviceObject.setZoom(16);}, 50);
    } else {
        Gmaps.map.adjustMapToBounds();
    }
    addlisteners(markers, 0);
}

function addlisteners(markers,recursive) {

    if (recursive <= markers.length-1) {
        google.maps.event.addListener(markers[recursive].serviceObject, 'mouseover', function () {
            markers[recursive].infowindow.open(Gmaps.map.map, markers[recursive].serviceObject);
        });


        google.maps.event.addListener(markers[recursive].serviceObject, 'mouseout', (function () {
            markers[recursive].infowindow.close(Gmaps.map.map, markers[recursive].serviceObject);
        }));
    }


    if (recursive != (markers.length)) {

            addlisteners(markers, recursive+1);
    }
}

var new_markers = <%= raw @receiving  %>;
setTimeout(function () {
    Gmaps.map.replaceMarkers(new_markers);
    Gmaps.map.listen_to_markers(new_markers);
}, 200);

