<% if !@alert.nil? %>
    flash_notice('<%= escape_javascript(@alert) %>');
<% end %>

Gmaps.map.listen_to_markers = function(markers){
    if (markers.length == 1) {
        Gmaps.map.auto_zoom = false;
        setTimeout(function() { Gmaps.map.serviceObject.setZoom(16);}, 50);
    } else {
        Gmaps.map.adjustMapToBounds();
    }
    for(var i = 0; i < markers.length; i++){
        marker = markers[i];

        Gmaps.map.event.addEventListener(Gmaps.map.map, 'mouseover', function (marker) {
            marker.infowindow.open(Gmaps.map.map, marker.serviceObject);
        });
        Gmaps.map.event.addEventListener(Gmaps.map.map, 'mouseout', function (marker) {
            marker.infowindow.close(Gmaps.map.map, marker.serviceObject);
        });
    }
}

Gmaps.map.callback = function(){
    Gmaps.map.listen_to_markers(Gmaps.map.markers);
}

var new_markers = <%= raw @receiving  %>;
Gmaps.map.replaceMarkers(new_markers);
Gmaps.map.listen_to_markers(new_markers);